# Plano de Implementa√ß√£o - Painel de Administra√ß√£o SaaS

## 1. Vis√£o Geral
Sistema administrativo completo para gest√£o do SaaS FinanceControl, permitindo √† equipa de suporte gerir todos os aspectos do sistema.

## 2. An√°lise da Estrutura Atual

### Sistema de Roles Atual
- **member**: Utilizador normal
- **admin**: Administrador de organiza√ß√£o
- **owner**: Propriet√°rio da organiza√ß√£o

### Novo Sistema de Roles Proposto
- **super_admin**: Administrador global do sistema (equipa de suporte)
- **admin**: Administrador de organiza√ß√£o (clientes)
- **owner**: Propriet√°rio da organiza√ß√£o (clientes)
- **member**: Membro da organiza√ß√£o (clientes)

## 3. Arquitectura da Solu√ß√£o

### 3.1 Schema da Base de Dados

#### Novas Tabelas Necess√°rias:

**admin_users** - Utilizadores da equipa de suporte
```sql
- id: serial PRIMARY KEY
- email: varchar(255) UNIQUE NOT NULL
- password: varchar(255) NOT NULL
- firstName: varchar(100)
- lastName: varchar(100)
- role: varchar(50) DEFAULT 'admin' -- 'super_admin', 'admin'
- permissions: jsonb -- Permiss√µes espec√≠ficas
- isActive: boolean DEFAULT true
- lastLoginAt: timestamp
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**payment_methods** - M√©todos de pagamento configur√°veis
```sql
- id: serial PRIMARY KEY
- name: varchar(100) NOT NULL -- 'stripe', 'paypal', 'bank_transfer'
- displayName: varchar(100) NOT NULL
- isActive: boolean DEFAULT true
- config: jsonb -- Configura√ß√µes espec√≠ficas
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**landing_content** - Conte√∫do gerenci√°vel da landing page
```sql
- id: serial PRIMARY KEY
- section: varchar(100) NOT NULL -- 'hero', 'features', 'testimonials', 'pricing'
- content: jsonb NOT NULL -- Conte√∫do estruturado
- isActive: boolean DEFAULT true
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**campaigns** - Campanhas e promo√ß√µes
```sql
- id: serial PRIMARY KEY
- name: varchar(255) NOT NULL
- description: text
- discountType: varchar(50) -- 'percentage', 'fixed_amount', 'free_trial'
- discountValue: decimal(10,2)
- couponCode: varchar(100) UNIQUE
- validFrom: timestamp
- validUntil: timestamp
- usageLimit: integer
- usageCount: integer DEFAULT 0
- isActive: boolean DEFAULT true
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**system_settings** - Configura√ß√µes do sistema
```sql
- id: serial PRIMARY KEY
- key: varchar(100) UNIQUE NOT NULL
- value: jsonb NOT NULL
- description: text
- category: varchar(100) -- 'trial', 'payments', 'notifications', 'security'
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**legal_content** - Conte√∫do legal e termos
```sql
- id: serial PRIMARY KEY
- type: varchar(100) NOT NULL -- 'terms', 'privacy', 'contacts', 'contracts'
- title: varchar(255) NOT NULL
- content: text NOT NULL
- version: varchar(20) NOT NULL
- isActive: boolean DEFAULT true
- createdAt: timestamp DEFAULT NOW()
- updatedAt: timestamp DEFAULT NOW()
```

**audit_logs** - Logs de auditoria
```sql
- id: serial PRIMARY KEY
- adminUserId: integer REFERENCES admin_users(id)
- action: varchar(255) NOT NULL
- entityType: varchar(100) -- 'user', 'plan', 'campaign', etc.
- entityId: integer
- oldData: jsonb
- newData: jsonb
- ipAddress: varchar(45)
- userAgent: text
- createdAt: timestamp DEFAULT NOW()
```

### 3.2 Estrutura de Permiss√µes

#### Grupos de Permiss√µes
```javascript
const PERMISSIONS = {
  PLANS: {
    VIEW: 'plans.view',
    CREATE: 'plans.create',
    UPDATE: 'plans.update',
    DELETE: 'plans.delete',
    MANAGE_PRICING: 'plans.manage_pricing'
  },
  USERS: {
    VIEW: 'users.view',
    CREATE: 'users.create',
    UPDATE: 'users.update',
    DELETE: 'users.delete',
    MANAGE_SUBSCRIPTIONS: 'users.manage_subscriptions'
  },
  PAYMENTS: {
    VIEW: 'payments.view',
    MANAGE_METHODS: 'payments.manage_methods',
    PROCESS_REFUNDS: 'payments.process_refunds'
  },
  CAMPAIGNS: {
    VIEW: 'campaigns.view',
    CREATE: 'campaigns.create',
    UPDATE: 'campaigns.update',
    DELETE: 'campaigns.delete'
  },
  CONTENT: {
    VIEW: 'content.view',
    MANAGE_LANDING: 'content.manage_landing',
    MANAGE_LEGAL: 'content.manage_legal'
  },
  SYSTEM: {
    VIEW_SETTINGS: 'system.view_settings',
    MANAGE_SETTINGS: 'system.manage_settings',
    VIEW_LOGS: 'system.view_logs'
  }
};
```

## 4. Funcionalidades por M√≥dulo

### 4.1 Gest√£o de Planos
#### Funcionalidades:
- ‚úÖ Listar todos os planos
- ‚≠ê Criar novos planos
- ‚≠ê Editar planos existentes
- ‚≠ê Activar/desactivar planos
- ‚≠ê Ajustar pre√ßos
- ‚≠ê Configurar limites (contas, transa√ß√µes)
- ‚≠ê Gerir features por plano
- ‚≠ê Hist√≥rico de altera√ß√µes de pre√ßos

#### P√°ginas:
- `/admin/plans` - Lista de planos
- `/admin/plans/create` - Criar plano
- `/admin/plans/:id/edit` - Editar plano
- `/admin/plans/:id/pricing-history` - Hist√≥rico de pre√ßos

### 4.2 Gest√£o de M√©todos de Pagamento
#### Funcionalidades:
- ‚≠ê Listar m√©todos de pagamento
- ‚≠ê Activar/desactivar m√©todos
- ‚≠ê Configurar Stripe
- ‚≠ê Configurar PayPal
- ‚≠ê Configurar transfer√™ncia banc√°ria
- ‚≠ê Configurar Multicaixa Express
- ‚≠ê Testar conex√µes de pagamento

#### P√°ginas:
- `/admin/payment-methods` - Lista de m√©todos
- `/admin/payment-methods/:id/configure` - Configurar m√©todo

### 4.3 Gest√£o de Testes e Modalidades
#### Funcionalidades:
- ‚≠ê Configurar dura√ß√£o do per√≠odo de teste
- ‚≠ê Definir planos gratuitos
- ‚≠ê Configurar modalidades de teste
- ‚≠ê Gerir utilizadores em per√≠odo de teste
- ‚≠ê Estat√≠sticas de convers√£o

#### P√°ginas:
- `/admin/trial-settings` - Configura√ß√µes de teste
- `/admin/trial-users` - Utilizadores em teste

### 4.4 Gest√£o de Conte√∫do da Landing Page
#### Funcionalidades:
- ‚≠ê Editar sec√ß√£o Hero
- ‚≠ê Gerir funcionalidades destacadas
- ‚≠ê Gerir testemunhos
- ‚≠ê Configurar pre√ßos exibidos
- ‚≠ê Gerir FAQ
- ‚≠ê Preview das altera√ß√µes

#### P√°ginas:
- `/admin/landing-content` - Gerir conte√∫do
- `/admin/landing-content/preview` - Preview

### 4.5 Gest√£o de Utilizadores e Assinaturas
#### Funcionalidades:
- ‚≠ê Listar todos os utilizadores
- ‚≠ê Pesquisar utilizadores
- ‚≠ê Ver detalhes de utilizador
- ‚≠ê Gerir assinaturas
- ‚≠ê Alterar planos de utilizadores
- ‚≠ê Cancelar assinaturas
- ‚≠ê Processar reembolsos
- ‚≠ê Impersonar utilizadores (para suporte)

#### P√°ginas:
- `/admin/users` - Lista de utilizadores
- `/admin/users/:id` - Detalhes do utilizador
- `/admin/users/:id/subscription` - Gerir assinatura

### 4.6 Gest√£o de Campanhas e Promo√ß√µes
#### Funcionalidades:
- ‚≠ê Criar campanhas promocionais
- ‚≠ê Gerir c√≥digos de desconto
- ‚≠ê Configurar descontos percentuais/fixos
- ‚≠ê Definir per√≠odos de validade
- ‚≠ê Limitar uso de cupons
- ‚≠ê Estat√≠sticas de campanhas

#### P√°ginas:
- `/admin/campaigns` - Lista de campanhas
- `/admin/campaigns/create` - Criar campanha
- `/admin/campaigns/:id/edit` - Editar campanha
- `/admin/campaigns/:id/stats` - Estat√≠sticas

### 4.7 Gest√£o de Conte√∫do Legal
#### Funcionalidades:
- ‚≠ê Gerir Termos de Servi√ßo
- ‚≠ê Gerir Pol√≠tica de Privacidade
- ‚≠ê Gerir informa√ß√µes de Contacto
- ‚≠ê Gerir modelos de Contratos
- ‚≠ê Controlo de vers√µes
- ‚≠ê Publica√ß√£o de altera√ß√µes

#### P√°ginas:
- `/admin/legal-content` - Lista de conte√∫dos
- `/admin/legal-content/:type/edit` - Editar conte√∫do
- `/admin/legal-content/:type/versions` - Vers√µes

## 5. Dashboard Administrativo

### 5.1 M√©tricas Principais
- üìä N√∫mero total de utilizadores
- üìä Utilizadores activos
- üìä Receita mensal recorrente (MRR)
- üìä Taxa de convers√£o de trial
- üìä Churn rate
- üìä Distribui√ß√£o por planos
- üìä M√©todos de pagamento mais utilizados

### 5.2 Gr√°ficos e An√°lises
- üìà Crescimento de utilizadores
- üìà Receita ao longo do tempo
- üìà Convers√µes por fonte
- üìà Cancelamentos por motivo

## 6. Autentica√ß√£o e Seguran√ßa

### 6.1 Sistema de Autentica√ß√£o Admin
- ‚≠ê Login separado para administradores
- ‚≠ê Autentica√ß√£o de dois factores (2FA)
- ‚≠ê Sess√µes com timeout autom√°tico
- ‚≠ê Logs de acesso detalhados

### 6.2 Middleware de Seguran√ßa
- ‚≠ê Valida√ß√£o de permiss√µes
- ‚≠ê Rate limiting
- ‚≠ê Auditoria de ac√ß√µes
- ‚≠ê Prote√ß√£o CSRF

## 7. Plano de Implementa√ß√£o

### Fase 1: Funda√ß√£o (Semana 1-2) ‚úÖ CONCLU√çDO
1. **Criar schema da base de dados** ‚úÖ
   - Tabelas admin_users, system_settings, audit_logs
   - Migra√ß√£o da base de dados

2. **Sistema de autentica√ß√£o admin** ‚úÖ
   - Login admin separado
   - Middleware de permiss√µes
   - Estrutura base do painel

3. **Dashboard b√°sico** ‚úÖ
   - Layout principal
   - Navega√ß√£o
   - M√©tricas b√°sicas

### Fase 2: Gest√£o Core (Semana 3-4) ‚úÖ CONCLU√çDO
1. **Gest√£o de Planos** ‚úÖ
   - CRUD completo de planos
   - Ajuste de pre√ßos
   - Gest√£o de features

2. **Gest√£o de Utilizadores** ‚úÖ
   - Lista de utilizadores
   - Detalhes e edi√ß√£o
   - Gest√£o de assinaturas

### Fase 3: Funcionalidades Avan√ßadas (Semana 5-6)
1. **Gest√£o de Pagamentos**
   - Configura√ß√£o de m√©todos
   - Processamento de reembolsos

2. **Campanhas e Promo√ß√µes**
   - Sistema de cupons
   - Estat√≠sticas de campanhas

### Fase 4: Conte√∫do e Configura√ß√µes (Semana 7-8)
1. **Gest√£o de Conte√∫do**
   - Editor de landing page
   - Gest√£o de conte√∫do legal

2. **Configura√ß√µes do Sistema**
   - Configura√ß√µes de trial
   - Configura√ß√µes gerais

### Fase 5: An√°lises e Melhorias (Semana 9-10)
1. **Sistema de An√°lises**
   - M√©tricas avan√ßadas
   - Relat√≥rios detalhados

2. **Auditoria e Logs**
   - Sistema de auditoria completo
   - Logs de seguran√ßa

## 8. Estrutura de Ficheiros

```
/admin
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin-header.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin-sidebar.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin-layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics-card.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ revenue-chart.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user-growth-chart.tsx
‚îÇ   ‚îú‚îÄ‚îÄ plans/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plan-form.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ plan-list.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pricing-history.tsx
‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-list.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-details.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ subscription-manager.tsx
‚îÇ   ‚îú‚îÄ‚îÄ campaigns/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign-form.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign-list.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ campaign-stats.tsx
‚îÇ   ‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ landing-editor.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ legal-editor.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ content-preview.tsx
‚îÇ   ‚îî‚îÄ‚îÄ payments/
‚îÇ       ‚îú‚îÄ‚îÄ payment-methods.tsx
‚îÇ       ‚îú‚îÄ‚îÄ payment-config.tsx
‚îÇ       ‚îî‚îÄ‚îÄ refund-processor.tsx
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ login.tsx
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ plans/
‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îú‚îÄ‚îÄ campaigns/
‚îÇ   ‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îú‚îÄ‚îÄ payments/
‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ use-admin-auth.tsx
‚îÇ   ‚îú‚îÄ‚îÄ use-permissions.tsx
‚îÇ   ‚îî‚îÄ‚îÄ use-audit-log.tsx
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ admin-api.ts
‚îÇ   ‚îú‚îÄ‚îÄ permissions.ts
‚îÇ   ‚îî‚îÄ‚îÄ audit.ts
‚îî‚îÄ‚îÄ types/
    ‚îú‚îÄ‚îÄ admin.ts
    ‚îú‚îÄ‚îÄ permissions.ts
    ‚îî‚îÄ‚îÄ audit.ts
```

## 9. Estimativa de Tempo

- **Fase 1**: 20-25 horas
- **Fase 2**: 25-30 horas
- **Fase 3**: 20-25 horas
- **Fase 4**: 15-20 horas
- **Fase 5**: 15-20 horas

**Total estimado**: 95-120 horas (12-15 dias de trabalho)

## 10. Considera√ß√µes T√©cnicas

### 10.1 Performance
- Pagina√ß√£o para listas grandes
- Lazy loading de componentes
- Cache de m√©tricas computacionalmente caras

### 10.2 Seguran√ßa
- Valida√ß√£o rigorosa de permiss√µes
- Sanitiza√ß√£o de inputs
- Auditoria de todas as ac√ß√µes cr√≠ticas

### 10.3 Usabilidade
- Interface intuitiva
- Feedback visual para ac√ß√µes
- Confirma√ß√µes para ac√ß√µes cr√≠ticas

## 11. Depend√™ncias Adicionais

### Frontend
- `react-chartjs-2` - Gr√°ficos e an√°lises
- `date-fns` - Manipula√ß√£o de datas
- `react-markdown` - Editor de conte√∫do
- `react-select` - Sele√ß√£o avan√ßada

### Backend
- `bcryptjs` - Hash de senhas admin
- `jsonwebtoken` - Tokens JWT para admin
- `express-rate-limit` - Rate limiting
- `helmet` - Seguran√ßa HTTP

## 12. Pr√≥ximos Passos

1. **Aprova√ß√£o do plano** pelo utilizador
2. **Prioriza√ß√£o de funcionalidades** - quais implementar primeiro
3. **Defini√ß√£o de utilizadores admin** iniciais
4. **Configura√ß√£o de permiss√µes** espec√≠ficas
5. **In√≠cio da implementa√ß√£o** pela Fase 1

---

**Legenda:**
- ‚úÖ J√° implementado
- ‚≠ê A implementar
- üìä M√©trica/Dashboard
- üìà Gr√°fico/An√°lise